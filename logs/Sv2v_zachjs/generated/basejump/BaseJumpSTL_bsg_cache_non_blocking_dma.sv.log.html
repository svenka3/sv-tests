<head>
  <style>
    .log { font-family: "Courier New", Consolas, monospace; font-size: 80%; }
    .test-failed { background-color: #ffaaaa; }
    .test-passed { background-color: #aaffaa; }
  </style>
</head>
<body>
<h3><a href="https://github.com/zachjs/sv2v" target="_blank">zachjs-sv2v</a></h3>
<pre class="test-passed">
description: Tests imported from basejump
rc: 0 (means success: 1)
tags: basejump
incdirs: /tmpfs/src/github/sv-tests/third_party/cores/basejump_stl/bsg_noc /tmpfs/src/github/sv-tests/third_party/cores/basejump_stl/bsg_misc /tmpfs/src/github/sv-tests/third_party/cores/basejump_stl/bsg_cache
top_module: 
type: parsing
mode: parsing
files: <a href="../../../../third_party/cores/basejump_stl/bsg_cache/bsg_cache_non_blocking_pkg.v.html" target="file-frame">third_party/cores/basejump_stl/bsg_cache/bsg_cache_non_blocking_pkg.v</a> <a href="../../../../third_party/cores/basejump_stl/bsg_cache/bsg_cache_pkg.v.html" target="file-frame">third_party/cores/basejump_stl/bsg_cache/bsg_cache_pkg.v</a> <a href="../../../../third_party/cores/basejump_stl/bsg_misc/bsg_defines.v.html" target="file-frame">third_party/cores/basejump_stl/bsg_misc/bsg_defines.v</a> <a href="../../../../third_party/cores/basejump_stl/bsg_cache/bsg_cache_non_blocking_dma.v.html" target="file-frame">third_party/cores/basejump_stl/bsg_cache/bsg_cache_non_blocking_dma.v</a>
defines: 
time_elapsed: 1.051s
ram usage: 16644 KB
</pre>
<pre class="log">

zachjs-sv2v -I/tmpfs/src/github/sv-tests/third_party/cores/basejump_stl/bsg_noc -I/tmpfs/src/github/sv-tests/third_party/cores/basejump_stl/bsg_misc -I/tmpfs/src/github/sv-tests/third_party/cores/basejump_stl/bsg_cache <a href="../../../../third_party/cores/basejump_stl/bsg_cache/bsg_cache_non_blocking_pkg.v.html" target="file-frame">third_party/cores/basejump_stl/bsg_cache/bsg_cache_non_blocking_pkg.v</a> <a href="../../../../third_party/cores/basejump_stl/bsg_cache/bsg_cache_pkg.v.html" target="file-frame">third_party/cores/basejump_stl/bsg_cache/bsg_cache_pkg.v</a> <a href="../../../../third_party/cores/basejump_stl/bsg_misc/bsg_defines.v.html" target="file-frame">third_party/cores/basejump_stl/bsg_misc/bsg_defines.v</a> <a href="../../../../third_party/cores/basejump_stl/bsg_cache/bsg_cache_non_blocking_dma.v.html" target="file-frame">third_party/cores/basejump_stl/bsg_cache/bsg_cache_non_blocking_dma.v</a>
module bsg_cache_non_blocking_dma (
	clk_i,
	reset_i,
	dma_cmd_i,
	dma_cmd_v_i,
	dma_cmd_return_o,
	done_o,
	pending_o,
	ack_i,
	curr_dma_way_id_o,
	curr_dma_index_o,
	curr_dma_v_o,
	data_mem_pkt_v_o,
	data_mem_pkt_o,
	data_mem_data_i,
	dma_pkt_o,
	dma_pkt_v_o,
	dma_pkt_yumi_i,
	dma_data_i,
	dma_data_v_i,
	dma_data_ready_o,
	dma_data_o,
	dma_data_v_o,
	dma_data_yumi_i
);
	localparam [4:0] LB = 5&#39;b00000;
	localparam [4:0] LH = 5&#39;b00001;
	localparam [4:0] LW = 5&#39;b00010;
	localparam [4:0] LD = 5&#39;b00011;
	localparam [4:0] LBU = 5&#39;b00100;
	localparam [4:0] LHU = 5&#39;b00101;
	localparam [4:0] LWU = 5&#39;b00110;
	localparam [4:0] SB = 5&#39;b01000;
	localparam [4:0] SH = 5&#39;b01001;
	localparam [4:0] SW = 5&#39;b01010;
	localparam [4:0] SD = 5&#39;b01011;
	localparam [4:0] SM = 5&#39;b01101;
	localparam [4:0] BLOCK_LD = 5&#39;b01110;
	localparam [4:0] TAGST = 5&#39;b10000;
	localparam [4:0] TAGFL = 5&#39;b10001;
	localparam [4:0] TAGLV = 5&#39;b10010;
	localparam [4:0] TAGLA = 5&#39;b10011;
	localparam [4:0] AFL = 5&#39;b11000;
	localparam [4:0] AFLINV = 5&#39;b11001;
	localparam [4:0] AINV = 5&#39;b11010;
	localparam [4:0] ALOCK = 5&#39;b11011;
	localparam [4:0] AUNLOCK = 5&#39;b11100;
	localparam [2:0] e_tag_read = 0;
	localparam [2:0] e_tag_store = 1;
	localparam [2:0] e_tag_set_tag = 2;
	localparam [2:0] e_tag_set_tag_and_lock = 3;
	localparam [2:0] e_tag_invalidate = 4;
	localparam [2:0] e_tag_lock = 5;
	localparam [2:0] e_tag_unlock = 6;
	localparam [2:0] e_stat_read = 0;
	localparam [2:0] e_stat_clear_dirty = 1;
	localparam [2:0] e_stat_set_lru = 2;
	localparam [2:0] e_stat_set_lru_and_dirty = 3;
	localparam [2:0] e_stat_set_lru_and_clear_dirty = 4;
	localparam [2:0] e_stat_reset = 5;
	localparam [1:0] e_miss_fifo_dequeue = 0;
	localparam [1:0] e_miss_fifo_skip = 1;
	localparam [1:0] e_miss_fifo_invalidate = 2;
	localparam [3:0] MHU_IDLE = 0;
	localparam [3:0] MGMT_OP = 1;
	localparam [3:0] SEND_MGMT_DMA = 2;
	localparam [3:0] WAIT_MGMT_DMA = 3;
	localparam [3:0] READ_TAG1 = 4;
	localparam [3:0] SEND_DMA_REQ1 = 5;
	localparam [3:0] WAIT_DMA_DONE = 6;
	localparam [3:0] DEQUEUE_MODE = 7;
	localparam [3:0] READ_TAG2 = 8;
	localparam [3:0] SEND_DMA_REQ2 = 9;
	localparam [3:0] SCAN_MODE = 10;
	localparam [3:0] RECOVER = 11;
	parameter _sv2v_width_addr_width_p = 24;
	parameter [_sv2v_width_addr_width_p - 1:0] addr_width_p = &#34;inv&#34;;
	parameter _sv2v_width_data_width_p = 24;
	parameter [_sv2v_width_data_width_p - 1:0] data_width_p = &#34;inv&#34;;
	parameter _sv2v_width_block_size_in_words_p = 24;
	parameter [_sv2v_width_block_size_in_words_p - 1:0] block_size_in_words_p = &#34;inv&#34;;
	parameter _sv2v_width_sets_p = 24;
	parameter [_sv2v_width_sets_p - 1:0] sets_p = &#34;inv&#34;;
	parameter _sv2v_width_ways_p = 24;
	parameter [_sv2v_width_ways_p - 1:0] ways_p = &#34;inv&#34;;
	parameter lg_sets_lp = (sets_p == 1 ? 1 : $clog2(sets_p));
	parameter lg_ways_lp = (ways_p == 1 ? 1 : $clog2(ways_p));
	parameter lg_block_size_in_words_lp = (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p));
	parameter byte_sel_width_lp = ((data_width_p &gt;&gt; 3) == 1 ? 1 : $clog2(data_width_p &gt;&gt; 3));
	parameter tag_width_lp = ((addr_width_p - lg_sets_lp) - lg_block_size_in_words_lp) - byte_sel_width_lp;
	parameter dma_cmd_width_lp = ((ways_p == 1 ? 1 : $clog2(ways_p)) + (sets_p == 1 ? 1 : $clog2(sets_p))) + ((1 + tag_width_lp) * 2);
	parameter dma_pkt_width_lp = 1 + addr_width_p;
	parameter data_mem_pkt_width_lp = (((((5 + ((data_width_p &gt;&gt; 3) == 1 ? 1 : $clog2(data_width_p &gt;&gt; 3))) + (ways_p == 1 ? 1 : $clog2(ways_p))) + (sets_p == 1 ? 1 : $clog2(sets_p))) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + data_width_p) + (data_width_p &gt;&gt; 3);
	input clk_i;
	input reset_i;
	input [dma_cmd_width_lp - 1:0] dma_cmd_i;
	input dma_cmd_v_i;
	output wire [dma_cmd_width_lp - 1:0] dma_cmd_return_o;
	output reg done_o;
	output reg pending_o;
	input ack_i;
	output wire [lg_ways_lp - 1:0] curr_dma_way_id_o;
	output wire [lg_sets_lp - 1:0] curr_dma_index_o;
	output wire curr_dma_v_o;
	output reg data_mem_pkt_v_o;
	output wire [data_mem_pkt_width_lp - 1:0] data_mem_pkt_o;
	input [data_width_p - 1:0] data_mem_data_i;
	output wire [dma_pkt_width_lp - 1:0] dma_pkt_o;
	output reg dma_pkt_v_o;
	input dma_pkt_yumi_i;
	input [data_width_p - 1:0] dma_data_i;
	input dma_data_v_i;
	output wire dma_data_ready_o;
	output wire [data_width_p - 1:0] dma_data_o;
	output wire dma_data_v_o;
	input dma_data_yumi_i;
	localparam counter_width_lp = ((block_size_in_words_p + 1) == 1 ? 1 : $clog2(block_size_in_words_p + 1));
	localparam block_offset_width_lp = byte_sel_width_lp + lg_block_size_in_words_lp;
	localparam data_mask_width_lp = data_width_p &gt;&gt; 3;
	wire [(((((ways_p == 1 ? 1 : $clog2(ways_p)) + (sets_p == 1 ? 1 : $clog2(sets_p))) + 2) + tag_width_lp) + tag_width_lp) - 1:0] dma_cmd_in;
	wire [(((((ways_p == 1 ? 1 : $clog2(ways_p)) + (sets_p == 1 ? 1 : $clog2(sets_p))) + 2) + tag_width_lp) + tag_width_lp) - 1:0] dma_cmd_r;
	reg [(1 + addr_width_p) - 1:0] dma_pkt;
	assign dma_cmd_in = dma_cmd_i;
	assign dma_cmd_return_o = dma_cmd_r;
	assign dma_pkt_o = dma_pkt;
	reg [(((((5 + ((data_width_p &gt;&gt; 3) == 1 ? 1 : $clog2(data_width_p &gt;&gt; 3))) + (ways_p == 1 ? 1 : $clog2(ways_p))) + ((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p)))) + data_width_p) + (data_width_p &gt;&gt; 3)) - 1:0] data_mem_pkt;
	assign data_mem_pkt_o = data_mem_pkt;
	reg dma_cmd_dff_en;
	bsg_dff_reset_en #(.width_p(dma_cmd_width_lp)) dma_cmd_dff(
		.clk_i(clk_i),
		.reset_i(reset_i),
		.en_i(dma_cmd_dff_en),
		.data_i(dma_cmd_in),
		.data_o(dma_cmd_r)
	);
	reg [2:0] dma_state_r;
	reg [2:0] dma_state_n;
	reg counter_clear;
	reg counter_up;
	wire [counter_width_lp - 1:0] counter_r;
	bsg_counter_clear_up #(
		.max_val_p(block_size_in_words_p),
		.init_val_p(0)
	) dma_counter(
		.clk_i(clk_i),
		.reset_i(reset_i),
		.clear_i(counter_clear),
		.up_i(counter_up),
		.count_o(counter_r)
	);
	wire counter_fill_max;
	wire counter_evict_max;
	assign counter_fill_max = counter_r == (block_size_in_words_p - 1);
	assign counter_evict_max = counter_r == block_size_in_words_p;
	wire in_fifo_v_lo;
	wire [data_width_p - 1:0] in_fifo_data_lo;
	reg in_fifo_yumi_li;
	bsg_fifo_1r1w_small #(
		.width_p(data_width_p),
		.els_p(block_size_in_words_p)
	) in_fifo(
		.clk_i(clk_i),
		.reset_i(reset_i),
		.data_i(dma_data_i),
		.v_i(dma_data_v_i),
		.ready_o(dma_data_ready_o),
		.data_o(in_fifo_data_lo),
		.v_o(in_fifo_v_lo),
		.yumi_i(in_fifo_yumi_li)
	);
	reg out_fifo_v_li;
	wire out_fifo_ready_lo;
	wire [data_width_p - 1:0] out_fifo_data_li;
	bsg_two_fifo #(.width_p(data_width_p)) out_fifo(
		.clk_i(clk_i),
		.reset_i(reset_i),
		.v_i(out_fifo_v_li),
		.data_i(out_fifo_data_li),
		.ready_o(out_fifo_ready_lo),
		.v_o(dma_data_v_o),
		.data_o(dma_data_o),
		.yumi_i(dma_data_yumi_i)
	);
	assign out_fifo_data_li = data_mem_data_i;
	wire [addr_width_p - 1:0] dma_pkt_refill_addr;
	wire [addr_width_p - 1:0] dma_pkt_evict_addr;
	assign dma_pkt_refill_addr = {dma_cmd_r[tag_width_lp + (tag_width_lp - 1)-:((tag_width_lp + (tag_width_lp - 1)) &gt;= tag_width_lp ? ((tag_width_lp + (tag_width_lp - 1)) - tag_width_lp) + 1 : (tag_width_lp - (tag_width_lp + (tag_width_lp - 1))) + 1)], dma_cmd_r[(sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1)))-:(((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1)))) &gt;= (2 + (tag_width_lp + tag_width_lp)) ? (((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1)))) - (2 + (tag_width_lp + tag_width_lp))) + 1 : ((2 + (tag_width_lp + tag_width_lp)) - ((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1))))) + 1)], {block_offset_width_lp {1&#39;b0}}};
	assign dma_pkt_evict_addr = {dma_cmd_r[tag_width_lp - 1-:tag_width_lp], dma_cmd_r[(sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1)))-:(((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1)))) &gt;= (2 + (tag_width_lp + tag_width_lp)) ? (((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1)))) - (2 + (tag_width_lp + tag_width_lp))) + 1 : ((2 + (tag_width_lp + tag_width_lp)) - ((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1))))) + 1)], {block_offset_width_lp {1&#39;b0}}};
	function automatic [1:0] sv2v_cast_2;
		input reg [1:0] inp;
		sv2v_cast_2 = inp;
	endfunction
	function automatic [byte_sel_width_lp - 1:0] sv2v_cast_3B8F0;
		input reg [byte_sel_width_lp - 1:0] inp;
		sv2v_cast_3B8F0 = inp;
	endfunction
	localparam [2:0] DMA_DONE = 5;
	localparam [2:0] DMA_IDLE = 0;
	localparam [2:0] RECV_REFILL_DATA = 4;
	localparam [2:0] SEND_EVICT_ADDR = 2;
	localparam [2:0] SEND_EVICT_DATA = 3;
	localparam [2:0] SEND_REFILL_ADDR = 1;
	always @(*) begin
		done_o = 1&#39;b0;
		pending_o = 1&#39;b0;
		dma_cmd_dff_en = 1&#39;b0;
		counter_clear = 1&#39;b0;
		counter_up = 1&#39;b0;
		out_fifo_v_li = 1&#39;b0;
		in_fifo_yumi_li = 1&#39;b0;
		data_mem_pkt_v_o = 1&#39;b0;
		data_mem_pkt[5 + (((data_width_p &gt;&gt; 3) == 1 ? 1 : $clog2(data_width_p &gt;&gt; 3)) + ((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + ((data_width_p &gt;&gt; 3) - 1)))))] = 1&#39;b0;
		data_mem_pkt[(ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + ((data_width_p &gt;&gt; 3) - 1)))-:(((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + ((data_width_p &gt;&gt; 3) - 1)))) &gt;= (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + (data_width_p &gt;&gt; 3))) ? (((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + ((data_width_p &gt;&gt; 3) - 1)))) - (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + (data_width_p &gt;&gt; 3)))) + 1 : ((((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + (data_width_p &gt;&gt; 3))) - ((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + ((data_width_p &gt;&gt; 3) - 1))))) + 1)] = dma_cmd_r[(ways_p == 1 ? 1 : $clog2(ways_p)) + ((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1))))-:(((ways_p == 1 ? 1 : $clog2(ways_p)) + ((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1))))) &gt;= ((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + tag_width_lp))) ? (((ways_p == 1 ? 1 : $clog2(ways_p)) + ((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1))))) - ((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + tag_width_lp)))) + 1 : (((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + tag_width_lp))) - ((ways_p == 1 ? 1 : $clog2(ways_p)) + ((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1)))))) + 1)];
		data_mem_pkt[((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + ((data_width_p &gt;&gt; 3) - 1))-:((((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + ((data_width_p &gt;&gt; 3) - 1))) &gt;= (data_width_p + (data_width_p &gt;&gt; 3)) ? ((((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + ((data_width_p &gt;&gt; 3) - 1))) - (data_width_p + (data_width_p &gt;&gt; 3))) + 1 : ((data_width_p + (data_width_p &gt;&gt; 3)) - (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + ((data_width_p &gt;&gt; 3) - 1)))) + 1)] = {dma_cmd_r[(sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1)))-:(((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1)))) &gt;= (2 + (tag_width_lp + tag_width_lp)) ? (((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1)))) - (2 + (tag_width_lp + tag_width_lp))) + 1 : ((2 + (tag_width_lp + tag_width_lp)) - ((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1))))) + 1)], counter_r[0+:lg_block_size_in_words_lp]};
		data_mem_pkt[4 + (((data_width_p &gt;&gt; 3) == 1 ? 1 : $clog2(data_width_p &gt;&gt; 3)) + ((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + ((data_width_p &gt;&gt; 3) - 1)))))] = 1&#39;b0;
		data_mem_pkt[2 + (((data_width_p &gt;&gt; 3) == 1 ? 1 : $clog2(data_width_p &gt;&gt; 3)) + ((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + ((data_width_p &gt;&gt; 3) - 1)))))-:((2 + (((data_width_p &gt;&gt; 3) == 1 ? 1 : $clog2(data_width_p &gt;&gt; 3)) + ((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + ((data_width_p &gt;&gt; 3) - 1)))))) &gt;= (((data_width_p &gt;&gt; 3) == 1 ? 1 : $clog2(data_width_p &gt;&gt; 3)) + ((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + (data_width_p &gt;&gt; 3))))) ? ((2 + (((data_width_p &gt;&gt; 3) == 1 ? 1 : $clog2(data_width_p &gt;&gt; 3)) + ((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + ((data_width_p &gt;&gt; 3) - 1)))))) - (((data_width_p &gt;&gt; 3) == 1 ? 1 : $clog2(data_width_p &gt;&gt; 3)) + ((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + (data_width_p &gt;&gt; 3)))))) + 1 : ((((data_width_p &gt;&gt; 3) == 1 ? 1 : $clog2(data_width_p &gt;&gt; 3)) + ((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + (data_width_p &gt;&gt; 3))))) - (2 + (((data_width_p &gt;&gt; 3) == 1 ? 1 : $clog2(data_width_p &gt;&gt; 3)) + ((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + ((data_width_p &gt;&gt; 3) - 1))))))) + 1)] = sv2v_cast_2($clog2(data_width_p &gt;&gt; 3));
		data_mem_pkt[((data_width_p &gt;&gt; 3) == 1 ? 1 : $clog2(data_width_p &gt;&gt; 3)) + ((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + ((data_width_p &gt;&gt; 3) - 1))))-:((((data_width_p &gt;&gt; 3) == 1 ? 1 : $clog2(data_width_p &gt;&gt; 3)) + ((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + ((data_width_p &gt;&gt; 3) - 1))))) &gt;= ((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + (data_width_p &gt;&gt; 3)))) ? ((((data_width_p &gt;&gt; 3) == 1 ? 1 : $clog2(data_width_p &gt;&gt; 3)) + ((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + ((data_width_p &gt;&gt; 3) - 1))))) - ((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + (data_width_p &gt;&gt; 3))))) + 1 : (((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + (data_width_p &gt;&gt; 3)))) - (((data_width_p &gt;&gt; 3) == 1 ? 1 : $clog2(data_width_p &gt;&gt; 3)) + ((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + ((data_width_p &gt;&gt; 3) - 1)))))) + 1)] = sv2v_cast_3B8F0(0);
		data_mem_pkt[3 + (((data_width_p &gt;&gt; 3) == 1 ? 1 : $clog2(data_width_p &gt;&gt; 3)) + ((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + ((data_width_p &gt;&gt; 3) - 1)))))] = 1&#39;b1;
		data_mem_pkt[(data_width_p &gt;&gt; 3) - 1-:data_width_p &gt;&gt; 3] = {data_mask_width_lp {1&#39;b1}};
		data_mem_pkt[data_width_p + ((data_width_p &gt;&gt; 3) - 1)-:((data_width_p + ((data_width_p &gt;&gt; 3) - 1)) &gt;= (data_width_p &gt;&gt; 3) ? ((data_width_p + ((data_width_p &gt;&gt; 3) - 1)) - (data_width_p &gt;&gt; 3)) + 1 : ((data_width_p &gt;&gt; 3) - (data_width_p + ((data_width_p &gt;&gt; 3) - 1))) + 1)] = in_fifo_data_lo;
		dma_pkt_v_o = 1&#39;b0;
		dma_pkt[addr_width_p] = 1&#39;b0;
		dma_pkt[addr_width_p - 1-:addr_width_p] = dma_pkt_refill_addr;
		case (dma_state_r)
			DMA_IDLE: begin
				dma_cmd_dff_en = dma_cmd_v_i;
				dma_state_n = (dma_cmd_v_i ? (dma_cmd_in[2 + (tag_width_lp + (tag_width_lp - 1))] ? SEND_REFILL_ADDR : SEND_EVICT_ADDR) : DMA_IDLE);
			end
			SEND_REFILL_ADDR: begin
				dma_pkt_v_o = 1&#39;b1;
				dma_pkt[addr_width_p] = 1&#39;b0;
				dma_pkt[addr_width_p - 1-:addr_width_p] = dma_pkt_refill_addr;
				pending_o = 1&#39;b1;
				dma_state_n = (dma_pkt_yumi_i ? (dma_cmd_r[1 + (tag_width_lp + (tag_width_lp - 1))] ? SEND_EVICT_ADDR : RECV_REFILL_DATA) : SEND_REFILL_ADDR);
			end
			SEND_EVICT_ADDR: begin
				data_mem_pkt_v_o = dma_pkt_yumi_i;
				counter_up = dma_pkt_yumi_i;
				counter_clear = dma_pkt_yumi_i;
				dma_pkt_v_o = 1&#39;b1;
				dma_pkt[addr_width_p] = 1&#39;b1;
				dma_pkt[addr_width_p - 1-:addr_width_p] = dma_pkt_evict_addr;
				pending_o = 1&#39;b1;
				dma_state_n = (dma_pkt_yumi_i ? SEND_EVICT_DATA : SEND_EVICT_ADDR);
			end
			SEND_EVICT_DATA: begin
				data_mem_pkt_v_o = out_fifo_ready_lo &amp; ~counter_evict_max;
				out_fifo_v_li = 1&#39;b1;
				counter_up = out_fifo_ready_lo &amp; ~counter_evict_max;
				counter_clear = out_fifo_ready_lo &amp; counter_evict_max;
				pending_o = 1&#39;b1;
				dma_state_n = (out_fifo_ready_lo &amp; counter_evict_max ? (dma_cmd_r[2 + (tag_width_lp + (tag_width_lp - 1))] ? RECV_REFILL_DATA : DMA_DONE) : SEND_EVICT_DATA);
			end
			RECV_REFILL_DATA: begin
				data_mem_pkt_v_o = in_fifo_v_lo;
				data_mem_pkt[5 + (((data_width_p &gt;&gt; 3) == 1 ? 1 : $clog2(data_width_p &gt;&gt; 3)) + ((ways_p == 1 ? 1 : $clog2(ways_p)) + (((sets_p == 1 ? 1 : $clog2(sets_p)) + (block_size_in_words_p == 1 ? 1 : $clog2(block_size_in_words_p))) + (data_width_p + ((data_width_p &gt;&gt; 3) - 1)))))] = 1&#39;b1;
				in_fifo_yumi_li = in_fifo_v_lo;
				counter_up = in_fifo_v_lo &amp; ~counter_fill_max;
				counter_clear = in_fifo_v_lo &amp; counter_fill_max;
				pending_o = 1&#39;b1;
				dma_state_n = (in_fifo_v_lo &amp; counter_fill_max ? DMA_DONE : RECV_REFILL_DATA);
			end
			DMA_DONE: begin
				done_o = 1&#39;b1;
				counter_clear = ack_i;
				dma_state_n = (ack_i ? DMA_IDLE : DMA_DONE);
			end
			default: dma_state_n = DMA_IDLE;
		endcase
	end
	assign curr_dma_v_o = dma_state_r != DMA_IDLE;
	assign curr_dma_way_id_o = dma_cmd_r[(ways_p == 1 ? 1 : $clog2(ways_p)) + ((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1))))-:(((ways_p == 1 ? 1 : $clog2(ways_p)) + ((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1))))) &gt;= ((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + tag_width_lp))) ? (((ways_p == 1 ? 1 : $clog2(ways_p)) + ((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1))))) - ((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + tag_width_lp)))) + 1 : (((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + tag_width_lp))) - ((ways_p == 1 ? 1 : $clog2(ways_p)) + ((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1)))))) + 1)];
	assign curr_dma_index_o = dma_cmd_r[(sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1)))-:(((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1)))) &gt;= (2 + (tag_width_lp + tag_width_lp)) ? (((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1)))) - (2 + (tag_width_lp + tag_width_lp))) + 1 : ((2 + (tag_width_lp + tag_width_lp)) - ((sets_p == 1 ? 1 : $clog2(sets_p)) + (2 + (tag_width_lp + (tag_width_lp - 1))))) + 1)];
	always @(posedge clk_i)
		if (reset_i)
			dma_state_r &lt;= DMA_IDLE;
		else
			dma_state_r &lt;= dma_state_n;
endmodule

</pre>
</body>